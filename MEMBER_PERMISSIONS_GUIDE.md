# دليل صلاحيات الأعضاء في المجموعات

## نظرة عامة
تم إضافة نظام صلاحيات متقدم للأعضاء العاديين في المجموعات، مما يسمح للأدمن بالتحكم في ما يمكن للأعضاء فعله.

## الصلاحيات المتاحة للأعضاء

### 1. صلاحية الدعوة (Can Invite)
- **الافتراضي**: معطل
- **الوصف**: يسمح للأعضاء العاديين بدعوة مستخدمين جدد للمجموعة
- **التحكم**: يمكن للأدمن تفعيل/إلغاء هذه الصلاحية من تبويب "Permissions"

### 2. صلاحية عرض الأعضاء (Can View Members)
- **الافتراضي**: مفعل
- **الوصف**: يسمح للأعضاء العاديين برؤية قائمة أعضاء المجموعة
- **التحكم**: يمكن للأدمن إلغاء هذه الصلاحية لإخفاء قائمة الأعضاء

### 3. صلاحية مغادرة المجموعة (Can Leave Group)
- **الافتراضي**: مفعل
- **الوصف**: يسمح للأعضاء العاديين بمغادرة المجموعة طوعياً
- **التحكم**: يمكن للأدمن إلغاء هذه الصلاحية لمنع الأعضاء من المغادرة

## واجهة المستخدم

### للأدمن
- يمكن الوصول لجميع التبويبات (General, Members, Permissions, Notifications, Smart Features)
- يمكن تعديل جميع إعدادات المجموعة
- يمكن إدارة صلاحيات الأعضاء من تبويب "Permissions"
- يمكن إضافة/إزالة الأعضاء وتغيير أدوارهم

### للأعضاء العاديين
- **تبويب General**: عرض معلومات المجموعة فقط (غير قابل للتعديل)
- **تبويب Members**: 
  - عرض قائمة الأعضاء (إذا كانت الصلاحية مفعلة)
  - إضافة أعضاء جدد (إذا كانت صلاحية الدعوة مفعلة)
  - لا يمكن إزالة الأعضاء أو تغيير أدوارهم
- **تبويب Notifications**: التحكم في إعدادات الإشعارات الشخصية
- **تبويبات Permissions و Smart Features**: مخفية (للأدمن فقط)

## التحديثات التقنية

### Backend Changes

#### 1. نموذج المجموعة (Group.js)
```javascript
settings: {
  memberPermissions: {
    canInvite: { type: Boolean, default: false },
    canViewMembers: { type: Boolean, default: true },
    canLeaveGroup: { type: Boolean, default: true }
  }
}
```

#### 2. دوال التحقق من الصلاحيات
- `canMemberInvite(userId)`: التحقق من صلاحية الدعوة
- `canMemberViewMembers(userId)`: التحقق من صلاحية عرض الأعضاء
- `canMemberLeave(userId)`: التحقق من صلاحية المغادرة

#### 3. مسارات جديدة
- `PUT /api/groups/:groupId/member-permissions`: تحديث صلاحيات الأعضاء

### Frontend Changes

#### 1. GroupSettingsModal.js
- إضافة تبويب "Permissions" لإدارة صلاحيات الأعضاء
- تحديث واجهة الأعضاء لإظهار الصلاحيات المحدودة
- إضافة زر "Leave Group" للأعضاء
- إخفاء التبويبات غير المناسبة للأعضاء العاديين

## أمثلة الاستخدام

### سيناريو 1: مجموعة مفتوحة
```
canInvite: true
canViewMembers: true
canLeaveGroup: true
```
- الأعضاء يمكنهم دعوة آخرين
- يمكنهم رؤية جميع الأعضاء
- يمكنهم مغادرة المجموعة

### سيناريو 2: مجموعة مقيدة
```
canInvite: false
canViewMembers: true
canLeaveGroup: false
```
- الأعضاء لا يمكنهم دعوة آخرين
- يمكنهم رؤية الأعضاء
- لا يمكنهم مغادرة المجموعة

### سيناريو 3: مجموعة سرية
```
canInvite: false
canViewMembers: false
canLeaveGroup: true
```
- الأعضاء لا يمكنهم دعوة آخرين
- لا يمكنهم رؤية قائمة الأعضاء
- يمكنهم مغادرة المجموعة

## الأمان
- جميع التحققات تتم على مستوى الخادم
- الأعضاء لا يمكنهم تعديل صلاحياتهم
- الأدمن فقط يمكنه إدارة صلاحيات الأعضاء
- التحقق من الصلاحيات يتم في كل عملية

## الاختبار
لاختبار الميزات الجديدة:
1. أنشئ مجموعة جديدة
2. أضف أعضاء عاديين
3. جرب تغيير صلاحيات الأعضاء من تبويب "Permissions"
4. تحقق من أن الأعضاء العاديين يرون الواجهة المحدودة
5. اختبر كل صلاحية على حدة
